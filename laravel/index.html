<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">

	<title>Laravel Utils - UD</title>

        <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link rel="stylesheet" href="../css/highlight.css">
        <link href="../css/base.css" rel="stylesheet">
        <link href="../extra.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" href="..">UD</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            
            
                <li >
                    <a href="..">Welcome</a>
                </li>
            
            
            
                <li >
                    <a href="../git/">Git Utils</a>
                </li>
            
            
            
                <li >
                    <a href="../grunt/">Grunt Utils</a>
                </li>
            
            
            
                <li >
                    <a href="../mongodb/">Mongo DB Utils</a>
                </li>
            
            
            
                <li class="active">
                    <a href="./">Laravel Utils</a>
                </li>
            
            
            
                <li >
                    <a href="../ethmining/">Eth Mining</a>
                </li>
            
            
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                <li >
                    <a rel="next" href="../mongodb/">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="../ethmining/">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#laravel-utils">Laravel Utils</a></li>
        
            <li><a href="#composer">Composer</a></li>
        
            <li><a href="#laravel-vagrant">Laravel Vagrant</a></li>
        
            <li><a href="#structure">Structure</a></li>
        
            <li><a href="#environment">Environment</a></li>
        
            <li><a href="#creating-new-controller">Creating new controller</a></li>
        
            <li><a href="#passing-data-to-view">Passing data to view</a></li>
        
            <li><a href="#master-and-sections">Master and sections</a></li>
        
            <li><a href="#fast-if-statement-in-blade">Fast IF statement in blade</a></li>
        
            <li><a href="#more-about-configuration">More about configuration</a></li>
        
            <li><a href="#migration">Migration</a></li>
        
            <li><a href="#eloquent-orm">Eloquent [ORM]</a></li>
        
            <li><a href="#basic-modelcontrollerview-workflow">Basic model/controller/view workflow</a></li>
        
            <li><a href="#defining-relationships-with-eloquent">Defining Relationships With Eloquent</a></li>
        
            <li><a href="#forms-validation">Forms &amp; Validation</a></li>
        
            <li><a href="#updating-record">Updating Record</a></li>
        
            <li><a href="#authenticate-your-users">Authenticate Your Users</a></li>
        
    
    </ul>
</div></div>
            <div class="col-md-9" role="main">

<h1 id="laravel-utils">Laravel Utils</h1>
<h2 id="composer">Composer</h2>
<p>Php dependencies manager.
Install with</p>
<pre><code>- curl -sS https://getcomposer.org/installer | sudo php -- --install-dir=/usr/local/bin --filename=composer
</code></pre>
<p>Add something to your composer json</p>
<pre><code>- composer require phpspec/phpspec (vendor/pck)
</code></pre>
<p>More packages at</p>
<pre><code>- https://packagist.org/
</code></pre>
<p>Create a new virgin laravel project with</p>
<pre><code>- composer create-project laravel/laravel NAME
</code></pre>
<h2 id="laravel-vagrant">Laravel Vagrant</h2>
<p>Laravel ready environment.
You will need installed</p>
<pre><code>- virtualbox
- vagrant
- ansible 2+
</code></pre>
<p>Suggested repositories</p>
<pre><code>- https://github.com/andreafspeziale/laravel_vagrant
- https://github.com/gab88slash/vagrant-modern-php-development
</code></pre>
<h2 id="structure">Structure</h2>
<p>app HTTP --&gt; routes.php --&gt; route file</p>
<pre><code>- Route::get('about', 'PagesController@about');
</code></pre>
<p>This will search a PagesController with a method "about"</p>
<h2 id="environment">Environment</h2>
<p>Everything is inside .env file</p>
<h2 id="creating-new-controller">Creating new controller</h2>
<p>You can do this with laravel cli called Artisan</p>
<pre><code>- php artisan make:controller PagesController --plain (--plain doesn't exist anymore)
</code></pre>
<p>for help</p>
<pre><code>- php artisan help make:controller
</code></pre>
<h2 id="passing-data-to-view">Passing data to view</h2>
<p>First way</p>
<pre><code>- return view('pages.about')-&gt;with('name', $name);
- return view('pages.about')-&gt;with([
        'firstName' =&gt; 'Andrea',
        'lastName' =&gt; 'Speziale'
    ]);
- return view('pages.about', $data);
- return view('pages.about', compact('firstName', 'lastName'));
</code></pre>
<p>in the html</p>
<pre><code>- {!! $name !!} with escaping
- {{ $name }}
</code></pre>
<h2 id="master-and-sections">Master and sections</h2>
<p>Create an app.blade.php file which will contain the basic html, in master:</p>
<pre><code>&lt;body&gt;
    &lt;div class="container"&gt;
        @yield('content')
    &lt;/div&gt;
    @yield('footer') &lt;!-- You will be able to add this only in specific files --&gt;
&lt;/body&gt;
</code></pre>
<p>In a random contact page:</p>
<pre><code>@extends('app')
@section('content')
    &lt;h1&gt;Contact Me!&lt;/h1&gt;
    &lt;p&gt;Lorem ipsum&lt;/p&gt;
@stop
@section('footer')
    &lt;script&gt;some script&lt;/script&gt; &lt;!-- You will be able to avoid it in other pages --&gt;
@stop
</code></pre>
<h2 id="fast-if-statement-in-blade">Fast IF statement in blade</h2>
<p>Instead of opening php tags</p>
<pre><code>@if($firstName == "Andrea")
    &lt;h1&gt;About me: {{ $firstName }} {{ $lastName }}&lt;/h1&gt;
    &lt;p&gt;Lorem ipsum&lt;/p&gt;
@else
    &lt;p&gt;Error&lt;/p&gt;
@endif
</code></pre>
<p>We have also</p>
<pre><code>- @unless()
- The controller returning something like: $people = ['Alex', 'Gabri', 'Andre'];

@if(count($people))
    &lt;h3&gt;People I like:&lt;/h3&gt;
    &lt;ul&gt;
        @foreach($people as $person)
            &lt;li&gt;{{ $person }}&lt;/li&gt;
        @endforeach
    &lt;/ul&gt;
@endif
</code></pre>
<h2 id="more-about-configuration">More about configuration</h2>
<pre><code>- config folder--&gt;database.php
</code></pre>
<p>For example u will find mysql ready to get the configuration from the .env file.
This file is also ignored by the .gitignore file, so you can have separate config for local and production environment</p>
<pre><code>- 'host' =&gt; env('DB_HOST', 'localhost')
</code></pre>
<p>This will be searching for a DB_HOST variable in the env file and if it will be not found, will take the localhost as default</p>
<pre><code>- Default connection to mysql from database.php 'default' =&gt; env('DB_CONNECTION', 'mysql')
</code></pre>
<h2 id="migration">Migration</h2>
<p>Version control for DBs.
Tables as php classes.</p>
<p>Create the class and then create the table.</p>
<p>[I had to install manually sqlite - sudo apt-get install php5-sqlite]</p>
<pre><code>- php artisan migrate
- php artisan migrate:reset [roolback all migration]
- php artisan migrate:rollback [roolback last migration]
</code></pre>
<p>Example --&gt; create a table for Articles</p>
<pre><code>-  php artisan make:migration create_articles_table --create="articles"
</code></pre>
<p>If for example you want to add a new column for Articles</p>
<pre><code>- php artisan make:migration add_excerpt_to_articles_table --table="articles"
</code></pre>
<p>It will create a new file which "extends" articles and you will write in the up function the new column</p>
<pre><code>- $table-&gt;text("excerpt")-&gt;nullable(); //if you agree that your article excerpt could be empty
</code></pre>
<p>and you will write in the down function</p>
<pre><code>- $table-&gt;dropColumn("excerpt");
</code></pre>
<p>try to migrate it and rollback it too!</p>
<pre><code>- php artisan migrate
- php artisan:rollback --&gt; ERROR --&gt; you will need composer require doctrine/dbal
</code></pre>
<h2 id="eloquent-orm">Eloquent [ORM]</h2>
<p>Record implementation</p>
<pre><code>- php artisan create:model Article
</code></pre>
<p>Useful laravel cli for testing
    - php artisan tinker
        - $article = new App\Article
        - $article-&gt;title='my first article'
        - $article-&gt;body='lorem ipsum'
        - $article-&gt;published_at=Carbon\Carbon::now();
        - $article or $article-&gt;toArray();</p>
<p>Now make it persistent</p>
<pre><code>    - $article-&gt;save();
</code></pre>
<p>Fetching it</p>
<pre><code>    - App\Article::all()-&gt;toArray();
</code></pre>
<p>Updating</p>
<pre><code>    - $article-&gt;title = 'My Updated First Article';
    - $article-&gt;save();
    - App\Article::all()-&gt;toArray();
</code></pre>
<p>How we could do it: select * from table where id = 1;</p>
<pre><code>    - $article = App\Article::find(1);
    - $article or $article-&gt;toArray();
</code></pre>
<p>How we could do it: select * from articles where body = 'lorem ipsum';</p>
<pre><code>    - $article = App\Article::where('body', 'lorem ipsum')-&gt;get();
    - $article = App\Article::where('body', 'lorem ipsum')-&gt;first(); to get the very first
</code></pre>
<p>Fill the object in one time</p>
<pre><code>    - $article = App\Article::create(['title'=&gt;'Very new article', 'body'=&gt;'New body', 'published_at'=&gt;Carbon\Carbon::now()]);

you will get a MassAssignmentException, so you will go to Article.php model and update it with

    -   protected $fillable=[
            'title',
            'body',
            'published_at'
        ];

exit from the tinker, re-open it and retry

    - $article = App\Article::create(['title'=&gt;'Very new article', 'body'=&gt;'New body', 'published_at'=&gt;Carbon\Carbon::now()]);
</code></pre>
<p>A fast way to update</p>
<pre><code>    - $article = App\Article::find(2);
    - $article-&gt;update(['body' =&gt; 'Updated!!']); //filling and saving it
</code></pre>
<h2 id="basic-modelcontrollerview-workflow">Basic model/controller/view workflow</h2>
<p>Different way to create routes</p>
<p>For small stuff you can create directly from route file something like</p>
<pre><code>Route::get('foo', function(){
    return "bar";
});
</code></pre>
<p>or</p>
<pre><code>Route::get('articles', 'ArticlesController@index');
</code></pre>
<p>now create a controller from command line</p>
<pre><code>- php artisan make:controller ArticlesController
</code></pre>
<p>and add an index method to see if does it works</p>
<pre><code>class ArticlesController extends Controller
{
    public function index() {
        return "Getting all articles";
    }
}
</code></pre>
<p>adding the class on the top</p>
<pre><code>- use App\Article;
</code></pre>
<p>and try to return all the articles (and then check the browser)</p>
<pre><code>class ArticlesController extends Controller
{
    public function index() {
        //return "Getting all articles";

        //fetching all the articles with eloquent
        $articles = \App\Article::all();
        return $articles;
    }
}
</code></pre>
<p>Now lets try to return a view with some stuff</p>
<pre><code>class ArticlesController extends Controller
{
    public function index() {
        //return "Getting all articles";

        //fetching all the articles with eloquent
        $articles = \App\Article::all();
        return view("articles.index", compact('articles'));
        //or return view("articles.index")-&gt;with('articles', $articles);
    }
}
</code></pre>
<p>now add the folder and file</p>
<pre><code>- mkdir resources/views/articles/index.blade.php
</code></pre>
<p>and fill it with</p>
<pre><code>@extends('app')
@section('content')
    &lt;h1&gt;Articles&lt;/h1&gt;
    &lt;hr&gt;
    @foreach($articles as $article)
        &lt;article&gt;
            &lt;a href="#"&gt;
                &lt;h3&gt;{{$article-&gt;title}}&lt;/h3&gt;
            &lt;/a&gt;
            &lt;div class="body"&gt;{{$article-&gt;body}}&lt;/div&gt;
        &lt;/article&gt;
    @endforeach
@stop
</code></pre>
<p>and what about clicking the article title? Lets add a new route</p>
<pre><code>- Route::get('articles/{id}', 'ArticlesController@show');
</code></pre>
<p>Now add the new function inside the controller accepting the $id</p>
<pre><code>public function show($id) {
    $article = Article::findOrFail($id);

    /*to avoid this you can use findOrFail
        dd($article);
        if(is_null($article)) { //if(!$article)
            abort(404);
        }
    */

    return view("articles.show", compact('article'));
}
</code></pre>
<p>and create the view</p>
<pre><code>- mkdir resources/views/articles/show.blade.php

@extends('app')
@section('content')
    &lt;h1&gt;Articles&lt;/h1&gt;
    &lt;hr&gt;
    @foreach($articles as $article)
        &lt;article&gt;
            {{--&lt;a href="/articles/{{$article-&gt;id}}"&gt;--}}
            {{--&lt;a href="{{url('/articles', $article-&gt;id)}}"&gt;--}}
            &lt;a href="{{action('ArticlesController@show', [$article-&gt;id])}}"&gt;
                &lt;h3&gt;{{$article-&gt;title}}&lt;/h3&gt;
            &lt;/a&gt;
            &lt;div class="body"&gt;{{$article-&gt;body}}&lt;/div&gt;
        &lt;/article&gt;
    @endforeach
@stop
</code></pre>
<h2 id="defining-relationships-with-eloquent">Defining Relationships With Eloquent</h2>
<p>We have for instance a Card which has many Notes. 
Each Note was wtitten by a User.</p>
<p>You can see below the models that describes those relationships:</p>
<pre><code>- Card Model
class Card extends Model
{
    public function notes()
    {
        return $this-&gt;hasMany(Note::class);
    }

    public function addNote(Note $note, $userId)
    {
        $note-&gt;user_id = $userId;
        return $this-&gt;notes()-&gt;save($note);
    }
}

- Note Model
class Note extends Model
{
    protected $fillable = ['body'];

    public function card()
    {
        return $this-&gt;belongsTo(Card::class);
    }

    public function user()
    {
        return $this-&gt;belongsTo(User::class);
    }

    public function by(User $user)
    {
        $this-&gt;user_id = $user-&gt;id;
    }
}
</code></pre>
<h2 id="forms-validation">Forms &amp; Validation</h2>
<p>Let's add a Note to a Card for instance:</p>
<pre><code>- add a posting route
Route::post('cards/{card}/notes', 'NotesController@store');

- add a form from the view
&lt;h3&gt;Add a new note&lt;/h3&gt;
    &lt;form action="/cards/{{ $card-&gt;id }}/notes" method="POST"&gt;
        {{-- showing the token --}}
        {!! csrf_token() !!}
        &lt;div class="form-group"&gt;
            &lt;textarea name="body" class="form-control"&gt;{{ old('body') }}&lt;/textarea&gt;
        &lt;/div&gt;
        &lt;div class="form-group"&gt;
            &lt;button type="submit" class="btn btn-default pull-right"&gt;Add note&lt;/button&gt;
        &lt;/div&gt;
        {{-- this include the generated token in the request --}}
        {!! csrf_field() !!}
    &lt;/form&gt;
    {{-- checking the validation exception message --}}
    {{-- {{ var_dump($errors) }} --}}
    @if(count($errors))
        &lt;ul&gt;
            @foreach($errors-&gt;all() as $error)
                &lt;li&gt;{{ $error }}&lt;/li&gt;
            @endforeach
        &lt;/ul&gt;
    @endif

- from the posting route by the store method
public function store(Request $request, Card $card)
    {
        $this-&gt;validate($request, [
            'body' =&gt; 'required|min:10'
        ]);

        $note = New Note($request-&gt;all());

        $card-&gt;addNote($note, 1);
        return back();
    }
</code></pre>
<h2 id="updating-record">Updating Record</h2>
<p>Let's try to update a Note</p>
<pre><code>- add a get and patch route to serve the update page and perform action 
Route::get('notes/{note}/edit', 'NotesController@edit');
Route::patch('notes/{note}', 'NotesController@update');

- edit form from the edit note page
&lt;form action="/notes/{{ $note-&gt;id }}" method="POST"&gt;
    {{ method_field('PATCH') }}
    &lt;div class="form-group"&gt;
        &lt;textarea name="body" class="form-control"&gt;{{ $note-&gt;body }}&lt;/textarea&gt;
    &lt;/div&gt;
    &lt;div class="form-group"&gt;
        &lt;button type="submit" class="btn btn-default pull-right"&gt;Update note&lt;/button&gt;
    &lt;/div&gt;
    {!! csrf_field() !!}
&lt;/form&gt;

- and the methods in the controller
public function edit(Note $note)
{
    return view('notes.edit', compact('note'));
}

public function update(Request $request, Note $note)
{
    $note-&gt;update($request-&gt;all());
    return back();
}
</code></pre>
<h2 id="authenticate-your-users">Authenticate Your Users</h2>
<p>Basic login/registration, usually is done at the very beginning of your project</p>
<pre><code>- php artisan make:auth
- php artisan migrate
</code></pre>
<p>Now you should be ready to test the laravel register and login out of the box functions</p>
<p>To test the forgotten psw e-mail you should change your local .env like this</p>
<pre><code>- MAIL_DRIVER=log
</code></pre>
<p>Setup also from config/mail.php</p>
<pre><code>- 'from' =&gt; ['address' =&gt; 'yourmail@something.something', 'name' =&gt; 'My Company Support']
</code></pre>
<p>Now if you try to restore your password it will run using your registration e-mail 
but you wont receive any e-mail, you will be able to check in</p>
<pre><code>- more storage/logs/laravel.log or tail -f storage/logs/laravel.log
</code></pre>
<p>You should see something like</p>
<pre><code>- Date: Sat, 30 Jul 2016 14:37:53 +0000
  Subject: Your Password Reset Link
  From: Andrea Speziale Mail &lt;andreaf.speziale@gmail.com&gt;
  To: andreaf.speziale@gmail.com
  MIME-Version: 1.0
  Content-Type: text/html; charset=utf-8
  Content-Transfer-Encoding: quoted-printable

  Click here to reset your password: 
  &lt;a href="http://localhost:8080/password/reset/5d09c9f1640669def46092bbecc8c02949be8b51bd1a1c49a180dea5613e1b9c?email=andreaf.speziale%40gmail.com"&gt; http://localhost:8080/password/reset/5d09c9f1640669def46092bbecc8c02949be8b51bd1a1c49a180dea5613e1b9c?email=andreaf.speziale%40gmail.com &lt;/a&gt;
</code></pre>
<p>If you copy on your browser the <a> link you will be redirect to the password reset page</p>
<p>Notice that in your routes file laravel added </p>
<pre><code>- Route::auth();
</code></pre>
<p>In Router.php searching for auth you will find all the route</p>
<p>If you need to override something you will find everything in</p>
<pre><code>- Http/Controller/auth
</code></pre>
<p>All the views are stored in</p>
<pre><code>- Resources/views/auth
</code></pre></div>
        </div>

        <footer class="col-md-12">
            <hr>
            
            <center>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</center>
        </footer>

        <script src="../js/jquery-1.10.2.min.js"></script>
        <script src="../js/bootstrap-3.0.3.min.js"></script>
        <script src="../js/highlight.pack.js"></script>
        <script>var base_url = '..';</script>
        <script data-main="../mkdocs/js/search.js" src="../mkdocs/js/require.js"></script>
        <script src="../js/base.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            From here you can search these documents. Enter
                            your search terms below.
                        </p>
                        <form role="form">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                            </div>
                        </form>
                        <div id="mkdocs-search-results"></div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>